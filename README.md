# ๐ Pizza Order System - Event-Driven Saga Architecture

## ๐ฏ ะฆะตะปั ะฟัะพะตะบัะฐ

ะะตะผะพะฝัััะฐัะธั ะพัะบะฐะทะพัััะพะนัะธะฒะพะน, ะผะฐัััะฐะฑะธััะตะผะพะน ัะธััะตะผั ะดะปั ัะพะทะดะฐะฝะธั, ะพะฟะปะฐัั ะธ ะฟะพะดัะฒะตัะถะดะตะฝะธั ะทะฐะบะฐะทะพะฒ ะฝะฐ ะพัะฝะพะฒะต ัะพะฑััะธะนะฝะพะน ะฐััะธัะตะบัััั ะธ ะฟะฐััะตัะฝะฐ **Saga (Choreography-based)**.

## ๐๏ธ ะััะธัะตะบัััะฐ ัะธััะตะผั

```
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
โ   ๐ค User       โโโโโถโ  ๐ช Nginx        โโโโโถโ ๐ Frontend     โ
โ                 โ    โ  API Gateway     โ    โ  Service        โ
โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                                โ                        โ
                                โ                        โ
                                โผ                        โผ
                       โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                       โ ๐ฆ Order        โ    โ ๐๏ธ Frontend DB  โ
                       โ  Service        โ    โ  (Pizzas)       โ
                       โโโโโโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโโโโโ
                                โ                        
                                โ                        
                                โผ                        
                       โโโโโโโโโโโโโโโโโโโ              
                       โ ๐ Kafka        โ              
                       โ  Events         โ              
                       โโโโโโโโโโโโโโโโโโโ              
                                โ                        
                    โโโโโโโโโโโโโผโโโโโโโโโโโโ           
                    โผ           โผ           โผ           
           โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
           โ ๐ณ Payment  โ โ ๐ง Notification โ โ โ๏ธ DLQ      โ
           โ  Service    โ โ  Service    โ โ  Handler    โ
           โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ
                    โ              โ              
                    โผ              โผ              
           โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ        
           โ ๐ฆ Payment  โ โ ๐ Prometheusโ        
           โ  Mock       โ โ  + Grafana  โ        
           โโโโโโโโโโโโโโโ โโโโโโโโโโโโโโโ        
```

## ๐ Saga Flow

1. **ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ** โ Order Service โ `OrderCreated` event
2. **ะะฑัะฐะฑะพัะบะฐ ะพะฟะปะฐัั** โ Payment Service โ `OrderPaid` / `PaymentFailed` 
3. **ะฃะฒะตะดะพะผะปะตะฝะธั** โ Notification Service โ User notification

## ๐ ะัััััะน ััะฐัั

### ๐ ะะฐะฟััะบ ะฒ GitHub Codespaces (ะะตะบะพะผะตะฝะดัะตััั)

[![Open in GitHub Codespaces](https://github.com/codespaces/badge.svg)](https://codespaces.new/your-username/pizza-order-system)

1. **ะะฐะถะผะธัะต ะบะฝะพะฟะบั "Open in GitHub Codespaces"** ะฒััะต
2. **ะะพะถะดะธัะตัั ะธะฝะธัะธะฐะปะธะทะฐัะธะธ** (ะทะฐะนะผะตั 2-3 ะผะธะฝััั)
3. **ะะฐะฟัััะธัะต ัะธััะตะผั:**
   ```bash
   docker compose up --build
   ```
4. **ะัะบัะพะนัะต ะณะปะฐะฒะฝัั ัััะฐะฝะธัั** ัะตัะตะท forwarded port 80
5. **ะะพะฝะธัะพัะธะฝะณ ะฑัะดะตั ะดะพัััะฟะตะฝ** ัะตัะตะท ัะพะพัะฒะตัััะฒัััะธะต ะฟะพััั (ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฝะฐัััะพะธััั)

**ะัะตะธะผััะตััะฒะฐ Codespaces:**
- โ ะะต ััะตะฑัะตั ะปะพะบะฐะปัะฝะพะน ัััะฐะฝะพะฒะบะธ Docker
- โ ะะฒัะพะผะฐัะธัะตัะบะฐั ะฝะฐัััะพะนะบะฐ ะฟะพััะพะฒ
- โ ะัััััะน ััะฐัั ะทะฐ 1 ะบะปะธะบ
- โ ะะพัััะฟ ะบ ะผะพะฝะธัะพัะธะฝะณั ะธะท ะปัะฑะพะณะพ ะผะตััะฐ

### ๐ป ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

**ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั:**
- Docker & Docker Compose
- 8GB RAM (ัะตะบะพะผะตะฝะดัะตััั)

**ะะฐะฟััะบ ัะธััะตะผั:**

```bash
# ะะปะพะฝะธััะตะผ ัะตะฟะพะทะธัะพัะธะน
git clone <repo-url>
cd pizza-order-system

# ะะฐะฟััะบ ะฒัะตะน ัะธััะตะผั
docker-compose up --build

# ะัะพะฒะตัะบะฐ ััะฐัััะฐ
docker-compose ps
```

### ะะพัััะฟะฝัะต ัะตัะฒะธัั

| ะกะตัะฒะธั | ะะพะบะฐะปัะฝัะน URL | Codespaces | ะะฟะธัะฐะฝะธะต |
|--------|---------------|------------|----------|
| **Frontend UI** | http://localhost | ะะพัั 80 | ะะตะฑ-ะธะฝัะตััะตะนั ะทะฐะบะฐะทะพะฒ |
| **API Gateway** | http://localhost/api | ะะพัั 80/api | Nginx ัะพััะธะฝะณ |
| **Grafana** | http://localhost:3000 | ะะพัั 3000 | ะะพะฝะธัะพัะธะฝะณ (admin/admin) |
| **Kafka UI** | http://localhost:8080 | ะะพัั 8080 | ะัะพัะผะพัั ัะพะฑััะธะน |
| **Prometheus** | http://localhost:9090 | ะะพัั 9090 | ะะตััะธะบะธ |

> ๐ก **ะ Codespaces** ะฒัะต ัััะปะบะธ ะฝะฐ ะผะพะฝะธัะพัะธะฝะณ ะฐะฒัะพะผะฐัะธัะตัะบะธ ะพะฑะฝะพะฒะปััััั ะฝะฐ ะฟัะฐะฒะธะปัะฝัะต forwarded URLs!

## ๐ ะัะฟะพะปัะทะพะฒะฐะฝะธะต ัะธััะตะผั

### ๐ ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ

1. ะัะบัะพะนัะต http://localhost
2. ะัะพัะผะพััะธัะต ะผะตะฝั ะฟะธัั
3. ะัะฑะตัะธัะต ะฟะธััั ะธ ะบะพะปะธัะตััะฒะพ
4. ะะฐะถะผะธัะต "ะะฐะบะฐะทะฐัั"
5. ะฃะบะฐะถะธัะต ะฐะดัะตั ะดะพััะฐะฒะบะธ
6. ะััะปะตะดะธัะต ััะฐััั ะทะฐะบะฐะทะฐ

### ๐ ะะพะฝะธัะพัะธะฝะณ ัะธััะตะผั

#### ๐ฏ ะะพัััะฟะฝัะต ะธะฝัะตััะตะนัั ะผะพะฝะธัะพัะธะฝะณะฐ:

| ะกะตัะฒะธั | URL | ะะพะณะธะฝ | ะะฟะธัะฐะฝะธะต |
|--------|-----|-------|----------|
| **Kafka UI** | http://localhost:8080 | - | ะกะพะฑััะธั ะฒ ัะตะฐะปัะฝะพะผ ะฒัะตะผะตะฝะธ |
| **Grafana** | http://localhost:3000 | admin/admin | ะะฐัะฑะพัะดั ะผะตััะธะบ |
| **Prometheus** | http://localhost:9090 | - | ะกัััะต ะผะตััะธะบะธ |
| **pgAdmin** | http://localhost:8081 | admin@pizza.app/admin | ะฃะฟัะฐะฒะปะตะฝะธะต ะะ |
| **cAdvisor** | http://localhost:8083 | - | ะะพะฝะธัะพัะธะฝะณ ะบะพะฝัะตะนะฝะตัะพะฒ |
| **Node Exporter** | http://localhost:9100 | - | ะกะธััะตะผะฝัะต ะผะตััะธะบะธ |
| **PostgreSQL Exporter** | http://localhost:9187 | - | ะะตััะธะบะธ ะฑะฐะทั ะดะฐะฝะฝัั |
| **Kafka Exporter** | http://localhost:9308 | - | ะะตััะธะบะธ Kafka |

#### ๐ ะะฐัะฑะพัะดั Grafana:
- **ะะธะทะฝะตั-ะผะตััะธะบะธ**: ะะฐะบะฐะทั, ะฟะปะฐัะตะถะธ, ัะฒะตะดะพะผะปะตะฝะธั
- **ะกะธััะตะผะฝัะต ะผะตััะธะบะธ**: CPU, ะฟะฐะผััั, ะดะธัะบ, ัะตัั
- **ะะตััะธะบะธ ะบะพะฝัะตะนะฝะตัะพะฒ**: Docker ัะตััััั
- **ะะตััะธะบะธ ะธะฝััะฐััััะบัััั**: Kafka, PostgreSQL

#### ๐ฏ ะะตัะพะดะพะปะพะณะธะธ ะผะพะฝะธัะพัะธะฝะณะฐ:
| ะะตัะพะดะพะปะพะณะธั | URL | ะะฟะธัะฐะฝะธะต |
|-------------|-----|----------|
| **USE Metrics** | http://localhost:3000/d/use-metrics | Utilization, Saturation, Errors |
| **RED Metrics** | http://localhost:3000/d/red-metrics | Rate, Errors, Duration |
| **LTES Metrics** | http://localhost:3000/d/ltes-metrics | Latency, Traffic, Errors, Saturation |

##### ๐ USE (ะดะปั ะธะฝััะฐััััะบัััั):
- **Utilization**: ะัะฟะพะปัะทะพะฒะฐะฝะธะต CPU, ะฟะฐะผััะธ, ะดะธัะบะพะฒ
- **Saturation**: ะะฐะณััะทะบะฐ ัะธััะตะผั, ะพัะตัะตะดะธ
- **Errors**: ะัะธะฑะบะธ ะะก, IO Wait, OOM kills

##### ๐ด RED (ะดะปั ัะตัะฒะธัะพะฒ):
- **Rate**: ะะพะปะธัะตััะฒะพ ะทะฐะฟัะพัะพะฒ ะฒ ัะตะบัะฝะดั
- **Errors**: ะัะพัะตะฝั ะพัะธะฑะพะบ (4xx, 5xx)
- **Duration**: ะัะตะผั ะพัะบะปะธะบะฐ (P50, P95, P99)

##### ๐ LTES (ะดะปั ัะฐัะฟัะตะดะตะปะตะฝะฝัั ัะธััะตะผ):
- **Latency**: ะัะตะผั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ, ะฟะปะฐัะตะถะตะน
- **Traffic**: ะะพัะพะบ ะดะฐะฝะฝัั Kafka, DB transactions
- **Errors**: ะกะฑะพะธ ัะตัะฒะธัะพะฒ, ะพัะบะฐัั ััะฐะฝะทะฐะบัะธะน
- **Saturation**: ะฃัะธะปะธะทะฐัะธั ะฟัะปะพะฒ ัะพะตะดะธะฝะตะฝะธะน

#### ๐ Kafka ัะพะฑััะธั:
- `order-events` - ัะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะพะฒ
- `payment-events` - ัะตะทัะปััะฐัั ะพะฟะปะฐัั
- `notification-events` - ัะฒะตะดะพะผะปะตะฝะธั
- `dlq-events` - ะฝะตัะดะฐัะฝัะต ัะพะฑััะธั

#### ๐๏ธ ะะพัััะฟ ะบ ะฑะฐะทะต ะดะฐะฝะฝัั:
- **ะฅะพัั**: localhost:5433
- **ะะพะปัะทะพะฒะฐัะตะปั**: pizza_user
- **ะะฐัะพะปั**: pizza_password
- **ะะฐะทะฐ ะดะฐะฝะฝัั**: pizza_system

### ๐งช ะขะตััะธัะพะฒะฐะฝะธะต ะพัะบะฐะทะพัััะพะนัะธะฒะพััะธ

```bash
# ะััะฐะฝะพะฒะธัั Payment Service (ัะธะผัะปััะธั ัะฑะพั)
docker-compose stop payment-service

# ะกะพะทะดะฐัั ะทะฐะบะฐะท - ัะฒะธะดะธัะต retry ะธ DLQ
curl -X POST http://localhost/api/v1/orders \
  -H "Content-Type: application/json" \
  -d '{
    "items": [{"pizzaId": "margherita", "quantity": 1}],
    "deliveryAddress": "Test Street 123",
    "paymentMethod": "card"
  }'

# ะะพัััะฐะฝะพะฒะธัั ัะตัะฒะธั
docker-compose start payment-service
```

## ๐๏ธ ะขะตัะฝะพะปะพะณะธัะตัะบะธะน ััะตะบ

| ะะพะผะฟะพะฝะตะฝั | ะขะตัะฝะพะปะพะณะธั | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|------------|------------|
| **Backend** | Python Flask | REST API ะผะธะบัะพัะตัะฒะธัั |
| **Frontend** | HTML/CSS/JS | ะะตะฑ-ะธะฝัะตััะตะนั |
| **Message Broker** | Apache Kafka | ะกะพะฑััะธะนะฝะฐั ะฐััะธัะตะบัััะฐ |
| **Database** | PostgreSQL | ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั |
| **Gateway** | Nginx | API ัะพััะธะฝะณ ะธ ะฑะฐะปะฐะฝัะธัะพะฒะบะฐ |
| **Monitoring** | Prometheus + Grafana | ะะตััะธะบะธ ะธ ะฐะปะตััั |
| **Orchestration** | Docker Compose | ะะฝััะฐััััะบัััะฐ |

## ๐ ะัะฝะพะฒะฝัะต ะฟะฐััะตัะฝั

### ๐ Saga Choreography
- ะะตัะตะฝััะฐะปะธะทะพะฒะฐะฝะฝะฐั ะบะพะพัะดะธะฝะฐัะธั ัะตัะตะท ัะพะฑััะธั
- ะะฐะถะดัะน ัะตัะฒะธั ะทะฝะฐะตั ัะฒะพั ัะพะปั ะฒ ะฑะธะทะฝะตั-ะฟัะพัะตััะต
- ะััััััะฒะธะต ะตะดะธะฝะพะน ัะพัะบะธ ะพัะบะฐะทะฐ

### ๐ฆ Outbox Pattern  
- ะขัะฐะฝะทะฐะบัะธะพะฝะฝะฐั ะฟัะฑะปะธะบะฐัะธั ัะพะฑััะธะน
- ะะฐัะฐะฝัะธั ะดะพััะฐะฒะบะธ ัะพะพะฑัะตะฝะธะน
- ะกะพะณะปะฐัะพะฒะฐะฝะฝะพััั ะดะฐะฝะฝัั ะธ ัะพะฑััะธะน

### ๐ Retry Pattern
- ะะฒัะพะผะฐัะธัะตัะบะธะต ะฟะพะฒัะพัั ะฟัะธ ัะฑะพัั
- ะญะบัะฟะพะฝะตะฝัะธะฐะปัะฝะฐั ะทะฐะดะตัะถะบะฐ
- ะะดะตะผะฟะพัะตะฝัะฝะพััั ะพะฟะตัะฐัะธะน

### โ๏ธ Dead Letter Queue
- ะะฑัะฐะฑะพัะบะฐ ะฝะตัะดะฐัะฝัั ัะพะฑััะธะน
- ะัะตะดะพัะฒัะฐัะตะฝะธะต ะฟะพัะตัะธ ะดะฐะฝะฝัั
- ะะพะฝะธัะพัะธะฝะณ ะฟัะพะฑะปะตะผ ัะธััะตะผั

## ๐๏ธ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
pizza-order-system/
โโโ services/
โ   โโโ frontend/              # ๐ Frontend Service
โ   โโโ order/                 # ๐ฆ Order Service  
โ   โโโ payment/               # ๐ณ Payment Service
โ   โโโ notification/          # ๐ง Notification Service
โ   โโโ payment-mock/          # ๐ฆ Payment Provider Mock
โโโ infrastructure/
โ   โโโ nginx/                 # ๐ช API Gateway
โ   โโโ kafka/                 # ๐ Message Broker
โ   โโโ monitoring/            # ๐ Prometheus + Grafana
โ   โโโ databases/             # ๐๏ธ PostgreSQL ััะตะผั
โโโ ui/                        # ๐ป Web Interface
โโโ docker-compose.yml         # ๐ณ ะะฝััะฐััััะบัััะฐ
โโโ README.md                  # ๐ ะะพะบัะผะตะฝัะฐัะธั
```

## ๐ง ะะฐะทัะฐะฑะพัะบะฐ

### ะะพะบะฐะปัะฝะฐั ัะฐะทัะฐะฑะพัะบะฐ

```bash
# ะะฐะฟััะบ ัะพะปัะบะพ ะธะฝััะฐััััะบัััั
docker-compose up -d postgres kafka zookeeper

# ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน ะดะปั ัะฐะทัะฐะฑะพัะบะธ
pip install -r requirements-dev.txt

# ะะฐะฟััะบ ะพัะดะตะปัะฝะพะณะพ ัะตัะฒะธัะฐ
cd services/order
python app.py
```

### ะะพะณะธัะพะฒะฐะฝะธะต

ะัะต ัะตัะฒะธัั ะธัะฟะพะปัะทััั ััััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต:

```python
import logging
logger = logging.getLogger(__name__)

logger.info("Order created", extra={
    "order_id": order_id,
    "user_id": user_id, 
    "total": total,
    "event_type": "order_created"
})
```

## ๐ ะะฑัะฐะทะพะฒะฐัะตะปัะฝัะต ััะตะฝะฐัะธะธ

### Happy Path
1. ะกะพะทะดะฐะฝะธะต ะทะฐะบะฐะทะฐ โ ััะฟะตัะฝะฐั ะพะฟะปะฐัะฐ โ ัะฒะตะดะพะผะปะตะฝะธะต
2. ะะฐะฑะปัะดะตะฝะธะต ัะพะฑััะธะน ะฒ Kafka
3. ะะพะฝะธัะพัะธะฝะณ ะผะตััะธะบ ะฒ Grafana

### Failure Scenarios  
1. ะกะฑะพะน Payment Service โ retry โ DLQ
2. ะะตัะตะณััะทะบะฐ ัะธััะตะผั โ circuit breaker
3. ะกะตัะตะฒัะต ะฟัะพะฑะปะตะผั โ eventual consistency

### Load Testing
```bash
# ะะตะฝะตัะฐัะธั ะฝะฐะณััะทะบะธ
ab -n 1000 -c 10 http://localhost/api/v1/menu
```

## ๐จ Troubleshooting

### ะะฑัะธะต ะฟัะพะฑะปะตะผั

**ะกะตัะฒะธั ะฝะต ะทะฐะฟััะบะฐะตััั:**
```bash
docker-compose logs <service-name>
```

**Kafka ะฝะต ะฟะพะดะบะปััะฐะตััั:**
```bash
# ะัะพะฒะตัะธัั ัะพะฟะธะบะธ
docker exec kafka kafka-topics --list --bootstrap-server localhost:9092
```

**ะะฐะทะฐ ะดะฐะฝะฝัั ะฝะตะดะพัััะฟะฝะฐ:**
```bash
# ะัะพะฒะตัะธัั ะฟะพะดะบะปััะตะฝะธะต
docker exec postgres psql -U pizza_user -d pizza_db -c "SELECT 1;"
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะถะธะดะฐะตะผัะต ะฟะพะบะฐะทะฐัะตะปะธ
- **Throughput**: 1000+ ะทะฐะบะฐะทะพะฒ/ะผะธะฝ
- **Latency**: < 100ms ะดะปั ัะพะทะดะฐะฝะธั ะทะฐะบะฐะทะฐ
- **Availability**: 99.9% uptime
- **Recovery Time**: < 30 ัะตะบัะฝะด

### ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต
```bash
# ะะฐัััะฐะฑะธัะพะฒะฐะฝะธะต Order Service
docker-compose up -d --scale order-service=3

# ะะพะฝะธัะพัะธะฝะณ ัะฐัะฟัะตะดะตะปะตะฝะธั ะฝะฐะณััะทะบะธ
docker-compose logs nginx | grep order-service
```

## ๐ค ะฃัะฐััะธะต ะฒ ัะฐะทัะฐะฑะพัะบะต

1. Fork ัะตะฟะพะทะธัะพัะธั
2. ะกะพะทะดะฐะนัะต feature branch
3. ะะพะฑะฐะฒััะต ัะตััั ะดะปั ะฝะพะฒะพะน ััะฝะบัะธะพะฝะฐะปัะฝะพััะธ  
4. ะฃะฑะตะดะธัะตัั ััะพ ะฒัะต ัะตััั ะฟัะพัะพะดัั
5. ะกะพะทะดะฐะนัะต Pull Request

---

**ะะฒัะพั**: Vladimir Pizza Team  
**ะะธัะตะฝะทะธั**: MIT  
**ะะตััะธั**: 1.0.0 